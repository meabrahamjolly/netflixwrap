@if (viewMode() === 'selection') {
<div class="selection-container">
    <div class="close-selector" (click)="closeSelection()">
        <span class="icon">Ã—</span>
        <span class="label">Go to Home</span>
    </div>
    <div class="header">
        <h1>Your Netflix Wrapped</h1>
        <p>Select a year to rewind.</p>
    </div>

    <div class="years-grid">
        @for (item of wrappedData; track item.year) {
        <div class="year-card" [style.background]="item.themeColor" (click)="selectYear(item.year)">
            <span class="year-text">{{ item.year }}</span>
            <span class="label">View Wrap</span>
        </div>
        }
    </div>
</div>
} @else if (viewMode() === 'report') {
<div class="report-container">
    <div class="report-nav">
        <div class="logo">NETFLIX WRAPPED</div>
        <div class="actions">
            <button class="btn secondary" (click)="switchToStory()">
                <span class="icon">â–¶</span> Play Stories
            </button>
            <button class="btn primary" (click)="closeSelection()">Go to Home</button>
        </div>
    </div>

    <!-- Hero Section -->
    <div class="section hero">
        <h1 class="animate-up">2025 Wrapped</h1>
        <h2 class="animate-up delay-1">Welcome back, Abraham</h2>
        <p class="animate-up delay-2">You lived in the cloud this year.</p>
    </div>

    <!-- Key Stats -->
    <div class="section stats-row">
        <div class="stat-card">
            <div class="value">
                @if(wrappedData[0].detailedStats?.totalMinutes) {
                {{ (wrappedData[0].detailedStats?.totalMinutes || 0) / 60 | number:'1.0-0' }}
                } @else {
                {{ wrappedData[0].totalHours }}
                }
            </div>
            <div class="label">Total Hours</div>
        </div>
        <div class="stat-card">
            <div class="value">{{ wrappedData[0].totalTitles }}</div>
            <div class="label">Titles Played</div>
        </div>
        <div class="stat-card">
            <div class="value">{{ wrappedData[0].joinDate }}</div>
            <div class="label">Member Since</div>
        </div>
    </div>

    <!-- Binge Behavior -->
    @if (wrappedData[0].bingeStats) {
    <div class="section binge-stats">
        <h3>Binge Behavior</h3>
        <div class="binge-grid">
            <div class="binge-card animate-up">
                <div class="icon-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12 2v4m0 12v4M4.93 4.93l2.83 2.83m8.48 8.48l2.83 2.83M2 12h4m12 0h4M4.93 19.07l2.83-2.83m8.48-8.48l2.83-2.83" />
                        <circle cx="12" cy="12" r="5" />
                    </svg>
                </div>
                <span class="stat-val">{{ wrappedData[0].bingeStats.longestSession }}</span>
                <span class="stat-lbl">Longest Session</span>
            </div>
            <div class="binge-card animate-up delay-1">
                <div class="icon-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z" />
                    </svg>
                </div>
                <span class="stat-val">{{ wrappedData[0].bingeStats.lateNightCount }}</span>
                <span class="stat-lbl">Late Nights (>2AM)</span>
            </div>
            <div class="binge-card animate-up delay-2">
                <div class="icon-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2" />
                        <line x1="16" y1="2" x2="16" y2="6" />
                        <line x1="8" y1="2" x2="8" y2="6" />
                        <line x1="3" y1="10" x2="21" y2="10" />
                        <path d="M8 14h.01M12 14h.01M16 14h.01M8 18h.01M12 18h.01M16 18h.01" />
                    </svg>
                </div>
                <span class="stat-val">{{ wrappedData[0].bingeStats.weekendMarathons }}</span>
                <span class="stat-lbl">Weekend Marathons</span>
            </div>
            <div class="binge-card full clickable animate-up delay-3"
                (click)="openMovieDetail(wrappedData[0].bingeStats.mostRewatched, 'https://image.tmdb.org/t/p/w500/ggFHVNu6YYI5L9pCfOacjizRGt.jpg')">
                <div class="icon-wrapper">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="17 1 21 5 17 9" />
                        <path d="M3 11V9a4 4 0 0 1 4-4h14" />
                        <polyline points="7 23 3 19 7 15" />
                        <path d="M21 13v2a4 4 0 0 1-4 4H3" />
                    </svg>
                </div>
                <div class="rewatch-content">
                    <span class="stat-val small">{{ wrappedData[0].bingeStats.mostRewatched }}</span>
                    <span class="stat-lbl">Most Rewatched</span>
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Watching Habits -->
    @if (wrappedData[0].detailedStats) {
    <section class="habits-section">
        <div class="habit-row">
            <div class="habit-item">
                <span class="label">Most Active Month</span>
                <span class="val highlight">{{ wrappedData[0].detailedStats.activeMonth }}</span>
            </div>
            <div class="habit-item">
                <span class="label">Favorite Day</span>
                <span class="val">{{ wrappedData[0].detailedStats.activeDay }}</span>
            </div>
            <div class="habit-item">
                <span class="label">Time of Day</span>
                <span class="val">{{ wrappedData[0].detailedStats.dayTime }}</span>
            </div>
        </div>
    </section>
    }

    <!-- Split Top Lists -->
    <div class="section split-list-section">
        <h3>Your Favorites</h3>
        <div class="split-container">
            <!-- Top Movies -->
            <div class="list-column">
                <h4>Top Movies</h4>
                <div class="top-list-grid">
                    @for (item of wrappedData[0].topMovies; track item.rank) {
                    <div class="list-item clickable" (click)="openMovieDetail(item.title, item.image)">
                        <span class="rank">{{ item.rank }}</span>
                        <img [src]="item.image" class="thumb">
                        <span class="title">{{ item.title }}</span>
                    </div>
                    }
                </div>
            </div>

            <!-- Top Series -->
            <div class="list-column">
                <h4>Top Series</h4>
                <div class="top-list-grid">
                    @for (item of wrappedData[0].topSeries; track item.rank) {
                    <div class="list-item clickable" (click)="openMovieDetail(item.title, item.image)">
                        <span class="rank">{{ item.rank }}</span>
                        <img [src]="item.image" class="thumb">
                        <span class="title">{{ item.title }}</span>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>

    <!-- Genre & Personality -->
    @if (wrappedData[0].genreStats) {
    <div class="section personality-section">
        <div class="glass-card personality-card animate-up">
            <div class="personality-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                    <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
                    <circle cx="12" cy="12" r="9" stroke-dasharray="2 4" />
                </svg>
            </div>
            <div class="badge">{{ wrappedData[0].genreStats.personalityType }}</div>
            <h2>The Sci-Fi Visionary</h2>
            <p class="subtitle">You explored new worlds this year.</p>

            <div class="genre-insights">
                <div class="genre-stat">
                    <span class="label">Top Genre</span>
                    <span class="value">{{ wrappedData[0].genreStats.topGenre }}</span>
                </div>
                <div class="genre-stat">
                    <span class="label">Surprise</span>
                    <span class="value">{{ wrappedData[0].genreStats.surpriseGenre }}</span>
                </div>
            </div>

            <div class="genre-visualization">
                <div class="progress-stack">
                    @for (g of wrappedData[0].genreStats.pieChart; track g.label) {
                    <div class="progress-layer" [style.width.%]="g.value" [style.background]="g.color"
                        [attr.data-label]="g.label">
                        <span class="tooltip">{{ g.label }} {{ g.value }}%</span>
                    </div>
                    }
                </div>
                <div class="visualization-legend">
                    @for (g of wrappedData[0].genreStats.pieChart; track g.label) {
                    <div class="legend-pill">
                        <span class="dot" [style.background]="g.color"></span>
                        <span class="name">{{ g.label }}</span>
                        <span class="pct">{{ g.value }}%</span>
                    </div>
                    }
                </div>
            </div>
        </div>
    </div>
    }

    <!-- Share Card -->
    <div class="section share-report-section">
        <div class="share-card-container animate-up">
            <div class="wrapped-share-card">
                <div class="card-bg-glow"></div>
                <div class="card-content">
                    <div class="card-header">
                        <span class="logo-text">NETFLIX <span>WRAPPED</span></span>
                        <span class="year-label">2025</span>
                    </div>

                    <div class="main-stats">
                        <div class="big-number">
                            <span class="val">{{ wrappedData[0].totalHours }}</span>
                            <span class="unit">HOURS</span>
                        </div>
                    </div>

                    <div class="stats-pills">
                        <div class="pill">
                            <span class="p-label">TOP GENRE</span>
                            <span class="p-val">{{ wrappedData[0].genreStats?.topGenre }}</span>
                        </div>
                        <div class="pill highlight">
                            <span class="p-label">PERSONALITY</span>
                            <span class="p-val">{{ wrappedData[0].genreStats?.personalityType }}</span>
                        </div>
                    </div>

                    <div class="card-footer">
                        <span class="tag">#NetflixWrapped</span>
                        <div class="netflix-red-bar"></div>
                    </div>
                </div>
            </div>
            <button class="btn-download">
                <span class="icon">â¬‡</span>
                Download Share Card
            </button>
        </div>
    </div>

    <div class="footer">
        <button class="btn big" (click)="switchToSelection()">Explore Other Years</button>
    </div>
</div>
} @else {
<div class="story-container" [style.background]="currentStories()[currentIndex()].bg">
    <div class="progress-bars">
        @for (story of currentStories(); track story.id; let i = $index) {
        <div class="bar-container">
            <div class="bar" [class.active]="i === currentIndex()" [class.completed]="i < currentIndex()"
                [style.width.%]="i === currentIndex() ? progress() : (i < currentIndex() ? 100 : 0)">
            </div>
        </div>
        }
    </div>

    <div class="close-btn" (click)="returnToSelection()">Ã—</div>

    <div class="story-content" (click)="next()">
        <div class="tap-area left" (click)="prev(); $event.stopPropagation()"></div>
        <div class="tap-area right" (click)="next(); $event.stopPropagation()"></div>

        <div class="content-inner animate-in">
            <h1>{{ currentStories()[currentIndex()].title }}</h1>
            <h2>{{ currentStories()[currentIndex()].subtitle }}</h2>

            @if (currentStories()[currentIndex()].type === 'overview') {
            <div class="stats-grid overview">
                @for (stat of currentStories()[currentIndex()].stats; track stat.label) {
                <div class="stat-item">
                    <span class="value">{{ stat.value }}</span>
                    <span class="label">{{ stat.label }}</span>
                </div>
                }
            </div>
            }

            @if (currentStories()[currentIndex()].type === 'stat') {
            <div class="stats-grid charts">
                @if (currentStories()[currentIndex()].chart) {
                <div class="chart-container">
                    @for (item of currentStories()[currentIndex()].chart; track item.label) {
                    <div class="bar-group">
                        <span class="bar-label">{{ item.label }}</span>
                        <div class="bar-bg">
                            <div class="bar-fill" [style.width.%]="item.value" [style.background]="item.color"></div>
                        </div>
                        <span class="bar-value">{{ item.value }}%</span>
                    </div>
                    }
                </div>
                }
            </div>
            }

            @if (currentStories()[currentIndex()].type === 'top-list') {
            <div class="top-list-container">
                @for (item of currentStories()[currentIndex()].topList; track item.rank) {
                <div class="list-item">
                    <span class="rank">{{ item.rank }}</span>
                    <img [src]="item.image" class="thumb">
                    <span class="title">{{ item.title }}</span>
                </div>
                }
            </div>
            }

            @if (currentStories()[currentIndex()].type === 'genre-insight') {
            <div class="genre-insight-container">
                <div class="icon">ðŸŽ­</div>
                <div class="description-box">
                    <p>{{ currentStories()[currentIndex()].description }}</p>
                </div>
            </div>
            }

            @if (currentStories()[currentIndex()].description && currentStories()[currentIndex()].type !==
            'genre-insight' && currentStories()[currentIndex()].type !== 'stat' && currentStories()[currentIndex()].type
            !== 'overview') {
            <p>{{ currentStories()[currentIndex()].description }}</p>
            }

            @if (currentStories()[currentIndex()].image) {
            <img [src]="currentStories()[currentIndex()].image" class="story-image">
            }
        </div>
    </div>
</div>
}